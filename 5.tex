\chapter[Реализация ТПП изделий из ПКМ на основе многоагентной холонической системы]
{Реализация ТПП изделий из полимерных композиционных материалов на основе многоагентной системы}
\label{chap:realize}

% задача смоделировать информационную инфраструктуру приборостроительного предприятия
% Все модули расширения должны быть вынесены за пределы базовых систем и должны
% быть реализованы в виде независимых интеллектуальных подсистем, определяющих
% поведение, связанных с ними агентов.

Для отработки методов организации многоагентной технологической сис\-темы
автором рассмотрена задача технологической подготовки производства изделий
из полимерных композиционных материалов.

Композиционные материалы
(от лат. \emph{composition}~--- составление) представляют собой многокомпонентные материалы,
состоящие из полимерной, металлической, углеродной, керамической или другой
основы, которая называется матрицей, армированной наполнителями из
волокон, нитевидных кристаллов, тонкодисперсионных частиц и др.
Путём подбора состава и свойств наполнителя и матрицы, их
соотношения, ориентации наполнителя можно получить новые материалы с
требуемым сочетанием эксплуатационных и~технологических свойств.
Именно сочетание разнородных веществ приводит к~созданию нового
материала, свойства которого количественно и~качественно отличаются от
свойств каждого из его составляющих.

Технологическая подготовка производства изделий из ПКМ сводится к~проектированию
технологии изготовления конструкции изделия и проектированию материала,
удовлетворяющего требованиям, предъявляемым к~данной конструкции, т.\,е.
создание материала и изделия совмещаются, при~этом сразу получается готовое изделие
заданной формы. Подобное
разделение существенно увеличивает количество инженерных изысканий, проводимых
в процессе ТПП, что в конечном итоге, приводит к необходимости задействования
большего количества средств автоматизации ТПП, а~также их интеграции.

По мнению автора, основная сложность проектирования технологии изготовления
изделий из ПКМ заключается в параллельности и многоитерационности данного процесса. После
получения исходных данных для проектирования в виде модели будущего
изделия и набора его характеристик (требований), на первом этапе необходимо сформировать
проект, используя для этого систему управления данными об изделии (PDM).
Систематизированные в PDM-системе данные передаются для анализа специалистам
по проектированию материалов (здесь и далее~см.~\autoref{fig:activity-pcm}). На этом этапе должны быть задействованы
специализированные экспертные модули, позволяющие из простого набора
параметров изделия составить примерную модель будущего материала, представленную
в виде фреймов. На основании имеющихся характеристик происходит
первичный отбор компонентов ПКМ (либо полуфабрикатов: препрегов, премиксов и~т.\,д.) из сторонней БД полимерных материалов, которые
также заносятся в PDM-систему. При этом проект из фазы начального проектирования
переходит в фазу проектирования материала (в соответствии с используемым
на предприятии регламентом).
{\parfillskip=0pt

}

\begin{figure}[p!]
    \centering
    \includegraphics[width=\textwidth]{activity-pcm.eps}
    \caption{UML-диаграмма деятельности ТПП изделий из ПКМ}
    \label{fig:activity-pcm}
\end{figure}


Полученные данные об элементах композиции передаются в специализированную систему
моделирования материала, где создаётся математическая модель композиции.
Далее модель передаётся системе (либо CAE-модулю\slash решателю) конечноэлементного
анализа, где определяется ориентация волокон и строиться матрица жесткости.
Данные параметры помещается в~базу PDM системы, при этом проект переводиться в
состояние <<\emph{Проверка полученного материала}>>. После этого геометрическая модель
разрабатываемого изделия и характеристики материала (в виде данных) 
направляются в~систему компьютерного моделирования для проверки соответствия
разработанного материала (и изделия) требованиям, полученным на
первом этапе. \mbox{В случае} неудачи создаётся новая версия проекта, после чего
уточняется состав композиции и проводится повторная проверка.\footnote{Если результат
стал ещё хуже, происходит возврат к предыдущей версии.}

Результат этих действий (данные о составе полимерной композиции и~её~свойствах)
сохраняется в PDM системе,\footnote{В дополнение к этому он может быть перенесён в
специальную базу материалов-аналогов, в
которой хранятся данный о составе вновь полученного материала, его характеристики и
область применения.} после чего проект переводится в фазу <<\emph{Проектирование
ТП изготовления}>>.

На этом этапе происходит разделение ТПП. С одной стороны, начинается работа
по созданию технологии производства материала, с другой~--- технологии изготовления
продукции. Первая задача требует постоянного обмена данными с системой
управления ресурсами предприятия (ERP). Ведь компоненты разработанного ПКМ
могут быть как на складах предприятия, так и на складах предприятий-партнёров,
либо должны быть заказаны (все,~либо только часть). Также должен быть учтён
вариант обращения к субподрядчикам, у которых можно заказать готовую полимерную
композицию в~соответствии с разработанным составом.

Проектирования ТП изготовления начинается с анализа элементов разработанной 
композиции и выбора технологии производства. Это может быть прессование,
экструзия, пултрузия, вакуумное формование, <<мокрая>> или <<сухая>> намотка,
автоклавное формование и~т.\,д. На этом этапе также требуется постоянный обмен информацией
между PDM- и ERP-системами с~целью выбора оборудования, либо обращения
к партнёрам (субподрядчикам).
{\parfillskip=0pt

}

Следующим этап~--- проектирование
средств технологического оснащения (СТО). Здесь необходимо учитывать информационные потоки, возникающие между
\nomenclature{СТО}{Средства технологического оснащения}
PDM-системой, системой (системами) проектирования управляющих программ и
системой проектирования геометрии оснастки (CAD).

На последнем этапе технологический процесс окончательно формализуется с
использованием системы автоматизированного проектирования технологических
процессов (CAPP): определяется последовательность операций, оформляется
комплект документации, осуществляется составления плана производства,
нормирование (что опять же требует работы с ERP-системой)~и~т.\,д.

В следующих разделах автором будет описана процедура одноранговой многоагентной
интеграции технологических данных и знаний, возникающих на всех
вышеописанных этапах ТПП изделий из ПКМ.

% Далее автором будет описана процедура разработки прототипа агент-ориентированной
% информационно-управляющей платформы, реализующий унитарное поле данных и знаний
% используемых в ТПП изделий из ПКМ.

% \section[Создание РВИС для моделирования информационной инфраструктуры предприятия]
% {Создание распределённого виртуального испытательного стенда для моделирования информационной инфраструктуры предприятия}
% \nomenclature{РВИС}{Распределённый виртуальный испытательный стенд}
% 
% Распределённый виртуальный испытательный стенд (РВИС) представляет собой тестовую
% информационно-телекоммуникационную среду, построенную на базе технологий
% облачных вычислений и предназначенную для тестирования средств информационного обеспечения,
% работающего в условиях крупного промышленного предприятия\footnote{Вопросы симуляции
% и эмуляции производственной управляющей многоагентной системы более подробно рассмотрены в
% работе~\cite{Germain-2003}.}.
% 
% \subsection{Выбор архитектуры и модели развертывания}
% 
% Облачные вычисления (англ. \emph{Cloud computing})~\cite{Antonopoulos-2010}~---
% термин, в общем случае означающий предоставление вычислительных ресурсов в виде
% сервиса, а не продукта. Потребители облачных вычислений могут значительно
% уменьшить расходы на инфраструктуру информационных технологий (в~краткосрочном и
% среднесрочном планах) и гибко реагировать на изменения вычислительных потребностей предприятия,
% используя свойства вычислительной эластичности (англ. \emph{Elastic computing})
% облачных услуг. Таксономия облачных вычислений представлена на~\autoref{fig:cloud-taxonomy}.
% 
% \begin{sidewaysfigure}[p!]
%     \centering
%     \includegraphics[width=\textwidth]{cloud-taxonomy.eps}
%     \caption[Таксономия облачных вычислений]
%             {Таксономия облачных вычислений}
%     \label{fig:cloud-taxonomy}
% \end{sidewaysfigure}
% 
% Следует отметить, что существуют самые разнообразные архитектуры облачных сервисов,
% однако, наиболее общая их классификация сводится к четырём типам:
% 
% \begin{enumerate}
% \item\emph{\bfseries Программное обеспечение как услуга} (\E{Software-as-a-Service}~--- SaaS)
% Самая простая категория, предполагающая всего лишь предоставление некоторого
% программного обеспечения в виде web-сервиса, как правило, предоставляемого через
% общественно доступные сети. Очевидно, что сам по себе данный сервис не представляет 
% никаких возможностей для интеграции, либо моделирования интеграции информационной
% среды предприятия.
% \item\emph{\bfseries Платформа как услуга} (\E{Platform-as-a-Service}~--- PaaS)
% Облако построенное по технологии PaaS значительно расширяет возможности имитационного
% моделирования информационного поля вследствие возможности вести разработку
% любого стороннего программного обеспечения в рамках предоставляемых облаком инструментальных
% средств (как правило, одного или нескольких языков программирования, отладочной
% среды и некоторого количества экземпляров объектов времени исполнения). Позволяет
% моделировать и разрабатывать инфраструктуру практически любой сложности, однако
% практически бесполезна при создании интеллектуальной интеграционной среды из-за
% сложности комбинирования <<облачных>> и локальных сервисов.
% \item\emph{\bfseries Аппаратное обеспечение как услуга} (\E{Hardware-as-a-Service}~--- HaaS)
% Предполагает наличие некоторого количества аппаратного обеспечения, сдаваемого
% в аренду. По большому счёту, не имеет отношения к классическим облачным технологиям,
% в литературе используется как необязательное связующее звено для перехода на 
% следующий уровень виртуализации вычислительных мощностей, поэтому в данном
% исследовании не рассматривается.
% \item\emph{\bfseries Инфраструктура как услуга} (\E{Infrastructure-as-a-Service}~--- IaaS)
% На сегодняшний день данная инфраструктура является наиболее востребованной, что
% обуславливается её высокой гибкостью и низкой стоимостью владения. Построенная на
% базе архитектуры HaaS, расширяет её, вводя понятие вычислительного юнита~---
% абстрактной единицы измерения объёма вычислений, в который могут входить
% не только мощности центрального процессора и памяти, но и объём и количество
% транзакций при обращении к блочным устройства, ресурсы виртуальной сети и
% прочие <<эластичные>> сущности.
% \end{enumerate}
% 
% Помимо классификации облачных сервисов по их архитектурной принадлежности существует 
% и вторая классификация~--- в соответствии с моделью развёртывания.
% Здесь можно выделить, как минимум, публичные, т.\,е. предоставляемые сторонними
% компаниями всем желающим в соответствии с установленными тарифами и
% частные~--- существующие в рамках одного предприятия и обслуживающие только его.
% 
% Для создания РВИС автором была выбрана архитектура IaaS и частная модель развёртывания.
% Выбор архитектуры для поставленной задачи был очевиден, а выбор модели развёртывания
% обуславливается наличием небольшого серверного парка, ресурсов которого оказалось
% достаточно для создания полноценного частного облака (характеристики используемого
% оборудования представлены в~\autoref{tab:equipment}).
% 
% \begin{table}[h!]
% \caption{Состав аппаратного комплекса РВИС}
% \begin{tabularx}{\textwidth}{lXr}
% \toprule
% Оборудование & Характеристики & Количество\tabularnewline
% \midrule
% 
% Сервер IBM x3650   &
% 2 процессора Intel Xeon E5405, 4\,ГБ ОЗУ DDR3 ECC, НЖМД IBM 146\,ГБ SAS, 2х1\,Гб LAN, ОС Scientific Linux~6.1  &
% 2\,шт
% \tabularnewline
% 
% Сервер Intel 5400  &
% 2 процессора Intel Xeon E5405, 4\,ГБ ОЗУ DDR3 ECC, НЖМД Seagete 320\,ГБ SATA, 2х1\,Гб LAN, ОС Scientific Linux~6.1 &
% 1\,шт.
% \tabularnewline
% 
% Сервер Intel 5500  &
% 2 процессора Intel Xeon E5606, 24\,ГБ ОЗУ DDR3 ECC, НЖМД Seagete 300\,ГБ SAS, 2х1\,Гб LAN, ОС Scientific Linux~6.1 &
% 2\,шт.\tabularnewline
% Сетевое хранилище  &
% 2 процессора Intel Xeon E5405, 4\,ГБ ОЗУ DDR3 ECC, Disk Shelve IBM 4200 12 НЖМД Seagete 500\,ГБ, 2х1\,Гб LAN, ОС Scientific Linux~6.1 &
% 1\,шт.\tabularnewline
% \bottomrule
% \end{tabularx}
% \label{tab:equipment}
% \end{table}
% 
% \subsection{Выбор монитора виртуальных машин}
% 
% \emph{Монитор виртуальных машин}\footnote{Монитор виртуальных машин также называют
% \emph{Гипервизором}.} (МВМ)~--- компьютерная программа,
% \nomenclature{МВМ}{Монитор виртуальных машин}
% реализующая параллельное выполнение нескольких или даже многих операционных систем
% на одном и том же хост-компьютере (узле распределённого кластера). МВМ обеспечивает изоляцию операционных
% систем друг от друга, защиту и безопасность, а также разделение ресурсов между
% различными запущенными ОС и управление ресурсами. Для РВИС гипервизор представляет
% собой ядро, установленное на каждый узел распределённой архитектуры стенда и
% обеспечивающий функционирование эмулируемых средств АСТПП и интеграцию между
% ними за счёт утилизации ресурсов виртуальной локальной вычислительной сети.
% 
% \begin{table}[h!]
% \caption{Сравнительная характеристика средств виртуализации РВИС}
% \begin{tabularx}{\textwidth}{X|XX}
% \toprule
% \diaghead(-4,1){\hskip\hsize}{\normalsize Хар-ка}{\normalsize МВМ} & \centering XEN & \centering KVM \tabularnewline
% \midrule
% 
% \hangindent=.7cm Поддерживаемые виды виртуализации  &
% \small\hangindent=.7cm Паравиртуализация (необходима модификация образа виртуальной машины)  &
% \small\hangindent=.7cm Полностью аппаратная виртуализация
% \tabularnewline
% 
% \hangindent=.7cm Возможность миграции виртуальных машин &
% \small\hangindent=.7cm Есть возможность балансировки нагрузки и миграции &
% \small\hangindent=.7cm Есть возможность балансировки нагрузки и миграции 
% \tabularnewline
% 
% \hangindent=.7cm Метод дистрибуции модулей &
% \small\hangindent=.7cm Представляет собой сторонний модуль, требующий перекомпиляции ядра ОС Linux &
% \small\hangindent=.7cm Является модулем ядра ОС Linux, начиная с версии 2.6.20
% \tabularnewline
% 
% \hangindent=.7cm Производительность виртуальных машин &
% \small\hangindent=.7cm Равна производительности хоста &
% \small\hangindent=.7cm Близка к производительности хоста
% \tabularnewline
% 
% \bottomrule
% \end{tabularx}
% \label{tab:hypervisors}
% \end{table}
% 
% На данный момент существует всего два МВМ, удовлетворяющих требованиям
% создания максимально открытой ИУС ТПП, это \E{Kernel-based Virtual Machine} (KVM),
% разработанный специалистами корпорации RedHat и XEN~--- продукт компании 
% \E{The Xen Project, XenSource, Inc.} Оба исследованных гипервизора распространяются
% под свободной лицензией, что позволяет использовать их не только для моделирования,
% но и для создания распределённых промышленных систем ТПП. Сравнительная характеристика
% обоих средств виртуализации приведена в~\autoref{tab:hypervisors}.
% 
% Очевидно, что оба исследуемых продукта обладают практически одинаковой функциональностью,
% необходимой для обслуживания гостевых виртуальных машин (ВМ).
% \nomenclature{ВМ}{Виртуальная машина}
% Тем не менее, автором был выбран гипервизор KVM. Выбор обусловлен возможностью
% беспрепятственного эмулирования систем любой сложности так, как если бы они были
% запущены не на стенде, а на физическом оборудовании, используемом на предприятии,
% а также возможностью переноса смоделированной среды в реальные производственные 
% условия без каких-либо модификаций. Общая архитектура РВИС, построенного на базе
% гипервизора KVM представлена на~\autoref{fig:rvis-arch}.
% 
% \begin{figure}[b!]
%     \centering
%     \includegraphics[width=\textwidth]{rvis-arch.eps}
%     \caption{Архитектура распределённого виртуального испытательного стенда}
%     \label{fig:rvis-arch}
% \end{figure}
% 
% KVM представляет собой программное решение, обеспечивающее виртуализацию в среде
% Linux на платформе x86-64, которая поддерживает аппаратную виртуализацию на базе
% Intel VT (Virtualization Technology) либо AMD SVM (Secure Virtual Machine). 
% 
% % Подход, используемых KVM, состоит в том, чтобы превратить ядро Linux в
% % полноценный МВМ простой загрузкой определённого модуля ядра. Модуль ядра
% % экспортирует специальное устройство (называемое /dev/kvm), которое включает
% % гостевой режим ядра. Данное виртуальное устройство позволяет каждой гостевой ВМ
% % иметь свое собственное адресное пространство, отдельное от адресного пространства
% % ядра или любых других работающих ВМ. Все устройства в дереве пользовательских
% % устройств являются общими. Но устройство, реализованное модулем KVM оличается
% % от всех остальных тем, что каждый процесс, который его открывает, видит другую
% % карту памяти, что позволяет поддерживать изоляцию ВМ.
% 
% % Когда KVM инсталлирован (добавлен в список используемых модулей), появляется
% % возможность запускать любую гостевую операционную систему в пространстве
% % пользователей (userspace). Каждая гостевая ОС становится отдельным вычислительным
% % процессом операционной системы хоста.
% На~\autoref{fig:kvm-arch} представлена схема
% виртуализации с KVM. Как видно из рисунка, в её основе лежит аппаратная платформа
% с функциями аппаратной виртуализации (см.~выше). На <<голом>> аппаратном
% обеспечении работает МВМ. МВМ реализует все функции доступные при использовании
% обычного ядра Linux, но это ядро может также поддерживать гостевые операционные
% системы, загруженные с помощью утилиты kvm. В итоге гостевая ОС получает
% возможность работать с  теми же приложения, что и базовая ОС.
% 
% \begin{figure}[h!]
%     \centering
%     \includegraphics[width=\textwidth]{kvm-arch.eps}
%     \caption[Схема виртуализации гипервизора KVM]
%             {Схема виртуализации гипервизора KVM}
%     \label{fig:kvm-arch}
% \end{figure}
% 
% Однако KVM решает не все проблемы виртуализации. Процессор поддерживает
% виртуализацию на аппаратном уровне. Память виртуализируется с помощью kvm. Наконец,
% система ввода\slash вывода виртуализируется с помощью слегка модифицированного
% процесса QEMU (копия которого выполняется с каждым процессом гостевой операционной системы).
% % 
% % KVM реализует новый режим работы процессов в Linux. Этот режим называется
% % \emph{guest} и используется для выполнения вычислительных процессов гостевой ОС.
% % В то время как режим ядра представляет собой привилегированный способ исполнения
% % программных кодов, режим пользователя (к которым относится guest) 
% % привилегированным не является. Следовательно, режим выполнения определяются для
% % разных целей, в зависимости от того, что выполняется и с какой целью. Режим
% % guest реализован для выполнения процессов гостевой ОС, но только для тех, которые
% % не являются вводом\slash выводом. В режиме guest реализованы два стандартных
% % режима, для того чтобы гостевая ОС не просто работала в этом режиме, но и могла\
% % поддерживать оба стандартных режима (режим ядра и пользовательский режим) для
% % своего ядра и приложений пространства пользователей. Режим пользователя
% % гостевой ОС необходим для того, чтобы выполнять операции ввода\slash вывода,
% % работающие независимо.
% 
% % Осуществление операции ввода\slash вывода с гостевой ОС обеспечивается QEMU.
% QEMU представляет собой платформу виртуализации, которая даёт возможность
% виртуализировать любое оборудование вычислительной системы (включая блочные
% устройства, графические адаптеры, сетевые устройства). Все запросы ввода\slash
% вывода от гостевой ОС, перехватываются и направляются в режим пользователя для
% эмуляции при помощью процесса QEMU.
% 
% % Виртуализация памяти в KVM выполняется с помощью того же специализированного
% % устройства, что и для эмулирования работы центрального процессора. Каждая
% % гостевая ОС обладает своим собственным адресным пространством,
% % распределяемым в момент инициализации гостевой ВМ. Физическая память, назначенная
% % гостевой ОС, является по сути виртуальной памятью процесса работающей ВМ. Для
% % преобразования адресов гостевых систем в реальные физические адреса существует набор
% % специальных теневых таблиц. Центральной процессор тоже имеет возможность преобразования
% % памяти посредством передачи управление МВМ в случае, когда гостевой процесс обращается
% % не к распределённому адресу памяти.
% 
% Для управления МВМ используется удалённая графическая оболочка Virtual Machine
% Manager~(\autoref{fig:vm-manager}), написанная на языке Python. Графическая оболочка независима от основной
% платформы и может быть установлена на любом внешнем компьютере, имеющим доступ 
% к сети Интернет. К основным функциям оболочки относятся: создание новых ВМ и
% включение их в кластер РВИС, доступ к консоли управления ВМ, сохранение
% состояния ВМ (создание точек восстановления), миграция ВМ между хостами РВИС
% и балансировка нагрузки.
% 
% \begin{figure}[t!]
%     \centering
%     \includegraphics[width=\textwidth]{vm-manager.png}
%     \caption[Интерфейс управления кластером РВИС]
%             {Интерфейс управления кластером РВИС}
%     \label{fig:vm-manager}
% \end{figure}

\section[Описание интегрируемых систем автоматизации ТПП]
        {Описание интегрируемых систем автоматизации технологической подготовки производства}
\label{sec:int-astpp}

В первую очередь 
необходимо описать упрощённую схему информационных потоков ТПП изделий из ПКМ (\autoref{fig:pcm-proc}).
\nomenclature{ПКМ}{Полимерный композиционный материал}
Из представленной схемы видно, что ТПП изделий из ПКМ можно условно разделить
на два больших подэтапа: \emph{проектирование материала} и \emph{разработка ТП изготовления}
конечного изделия. Отсюда следует, что для построения минимальной модели
ИУП ТПП необходимо в рамках единого информационного пространства как минимум обеспечить
интеллектуальное взаимодействие:

\begin{sidewaysfigure}[p!]
    \centering
    \includegraphics[height=.68\textheight]{pcm-proc.eps}
    \caption[Схема информационных потоков ТПП изделий из ПКМ]
            {Схема информационных потоков ТПП изделий из ПКМ}
    \label{fig:pcm-proc}
\end{sidewaysfigure}

\begin{itemize}
\item Программных систем, предназначенных для решения различных
    инженерных задач: расчётов, анализа и симуляции физических процессов (CAE). Для решения
    задач проектирования ТПП изделий из ПКМ были задействованы следующие
    системы: \emph{\bfseries Moldex3d} (система моделирования процессов заливки
    материала, выдержки под давлением, охлаждения, усадки, коробления и т.\,д.), \emph{\bfseries DIGIMAT}
    (платформа для полномасштабного конечно-элементного моделирования нелинейного поведения ПКМ и
    композитных структур), \emph{\bfseries Samcef} (программное \mbox{обеспечение} для расчётов методом конечных
    элементов), а также набор инструментальных средств для общеинженерных расчётов \emph{\bfseries SALOME}.
\item Организационно-технической системы, обеспечивающей управление всей
    информацией об изделии (PDM). Для интеграции была выбрана система \emph{\bfseries ENOVIA SmarTeam},
    используемая для управления жизненным циклом проектируемых изделий, а также в
    качестве интеллектуальной базы проектируемых ПКМ.
\item Интегрированной системы управления внутренними и внешними ресурсами
    приборостроительного предприятия (ERP). Была использована система \emph{\bfseries OpenERP}.
\item Системы автоматизированной технологической подготовки
    оборудования с числовым программным управлением (CAM). Использовалась
    базовая по своей функциональности система \emph{\bfseries PyCAM}, позволяющая создавать управляющие программы для
    трехкоординатных фрезерных станков, чего оказалось достаточно для отработки
    методов интеграции подобных систем.
\item Системы автоматизированной подготовки (написания) технологических процессов
    (CAPP). Была использована система \emph{\bfseries Вертикаль 2011}.
{\parfillskip=0pt

}
\item Вспомогательных баз данных хранящих различную справочную
    информацию и не являющихся частью ни одной
    из рассмотренных выше систем. Была использована система управления базами
    данных \emph{\bfseries PostgreSQL}, а также информационные адаптеры для
    web-ориентированных баз по материалам, таких как: \emph{\bfseries M-Base},
    \emph{\bfseries CAMPUS}, \emph{\bfseries MatWeb}.
\end{itemize}

Более подробное описание возможностей указанных автоматизированных систем технологической
подготовки производства представлено в~\autoref{app:astpp}.
В процессе моделирования на РВИС для каждой системы автоматизации ТПП, участвующей в интеграционной сети,
создана виртуальная машина, для каждого \mbox{специалиста}~--- виртуальное рабочее место.
Организационная модель интеграционной сети представлена на~\autoref{fig:rvis-model}.
\begin{figure}[h!]
    \centering
    \includegraphics[width=.9\textwidth]{rvis-model.eps}
    \caption[Организационная модель интеграционной сети ИУП ТПП]
            {Организационная модель интеграционной сети ИУП ТПП}
    \label{fig:rvis-model}
\end{figure}

Все виртуальные машины объединены в локальную сеть с доступом в~Интернет
через общий шлюз (на рисунке обозначен как \emph{маршрутизатор}). Безо\-пасность
и конфиденциальность данных достигается за счёт использования специализированных модулей
шифрования, обеспечивающих требуемый уровень защищённости коммуникационных каналов.

Как уже отмечалось в~\autoref{sec:mas-hardware} доступ к виртуальным рабочим местам
осуществляется через web-интерфейс, т.\,е. не требует создания какого-либо
дополнительного клиентского программного обеспечения. Пример ВРМ, позволяющего 
работать с CAE-системой Samcef, представлен на~\autoref{fig:screenshot-1}.
{\parfillskip=0pt

}
\begin{figure}[h!]
    \centering
    \includegraphics[width=\textwidth]{screenshot-1.png}
    \caption{Web-интерфейс виртуального рабочего места}
    \label{fig:screenshot-1}
\end{figure}




% \subsection{SALOME~6.4.0}
% 
% Система SALOME~6.4.0 представляет собой набор инструментальных средств для 
% решения инженерных задач, распространяемый под свободной лицензией. Основными 
% фукнциями данного пакета являются: 
% 
% \begin{figure}[t!]
%     \centering
%     \includegraphics[width=\textwidth]{salome.png}
%     \caption[Интерфейс системы SALOME]
%             {Интерфейс системы SALOME}
%     \label{fig:salome}
% \end{figure}
% 
% \begin{itemize}
% \item Взаимодействие с различными CAD-приложениями на уровне передачи данных об
%     исследуемой модели.
% \item Позволяет с лёгкостью добавлять в свой состав новые модули и компоненты за
%     счёт удобного программного интерфейса на языке Python, что даёт возможность
%     без труда включить его в состав описываемой в данной работе гетерогенной
%     ИУП ТПП.
% \item Обеспечивает удобный и эффективный пользовательский интерфейс, позволяющий
%     существенно снизить временные задержки при проведения исследований (\autoref{fig:salome}).
% \item Создание\slash модификация, импорт\slash экспорт (IGES, STEP, BREP), 
%     восстановление\slash чистка CAD-моделей.
% \item Работа с сеточными моделями (MED, UNV, DAT, STL): редактирование, проверка
%     качества для дальнейшей постобработки, импорт\slash экспорт.
% \item Обработка параметров специфицирующих исследуемые модели.
% \item Возможность осуществления расчётов с помощью одного или нескольких внешних
%     решателей (например, таких свободных программных библиотек как \emph{Code\_Saturn},
%     \emph{Code\_Aster}, \emph{OpenFOAM}~и~др.).
% \item Отображение результатов расчётов в векторной или скалярной форме.
% \end{itemize}
% 
% \subsection{SmarTeam~V5R20}
% \label{sec:smarteam}
% 
% PDM-cистема SmarTeam представляет собой быстро внедряемое и экономичное решение по управлению
% данными об изделии для средних и малых предприятий, построенное с использованием
% принципа обмена информацией на основе BOM (\E{Bill of Materials})~--- спецификаций,
% включающих в себя структуру изделия со всеми сопутствующими документами и ссылками. Этот пакет отличается от
% аналогичных систем других разработчиков наличием полноценной интеграции со всеми
% наиболее известными и используемыми сегодня в мировой практике CAD-системами,
% простотой в освоении и быстрой отдачей инвестиций после внедрения. Программный 
% интерфейс приложения представлен на~\autoref{fig:smarteam}.
% 
% К основным функциям, реализуемым средствами PDM-системы
% SmarTeam в сфере проектирования и подготовки производства, относятся
% следующие~\cite{Zilberburg-2008}:
% 
% \begin{figure}[t!]
%     \centering
%     \includegraphics[width=\textwidth]{smarteam.png}
%     \caption[Интерфейс PDM-системы SmarTeam V5R20]
%             {Интерфейс PDM-системы SmarTeam V5R20}
%     \label{fig:smarteam}
% \end{figure}
% 
% \begin{enumerate}
% \item Ведение проектов: управление работами, процедурами и документами в
%     составе проекта, контроль над выполнением проекта.
% \item Планирование и диспетчирование работ.
% \item Распределение прав доступа к информации между отдельными участниками проекта или их группами.
% \item Организация и ведение распределённых архивов конструкторской,
%     технологической и управленческой документации (электронные архивы).
% \item Управление изменениями в документации: контроль версий документов, ведение
%     протокола работы с документами, листов регистрации изменений и извещений.
% \item Фиксирование стандартных этапов прохождения документов, контроль
%     прохождения документов по этапам.
% \item Интеграция с CAD/CAM-системами и их приложениями, используемыми при проектировании.
% \item Контроль целостности проекта.
% \item Поиск необходимой информации в проекте на основании запросов.
% \end{enumerate}
% 
% SmarTeam обеспечивает прием информации, создаваемой на различных этапах жизненного
% цикла изделий, причем ввод информации может выполняться либо в
% CAD-системах, либо в самой PDM. Хранение информации осуществляется
% в базе данных известных систем управления базами данных~--- например, Oracle,
% InterBase или MS SQL-Server. Средства, позволяющие создавать структуры баз
% данных и экранные формы представления информации в интерактивном режиме, позволяют легко адаптировать
% SmarTeam к условиям предприятия~\cite{my_3}. Пользователи могут создавать базы
% данных стандартных и типовых деталей, используемых материалов, складов оснастки и др.
% Разработка программ для решения различных задач КТПП в среде SmarTeam выполняется
% с использованием  \emph{Интерфейса программирования приложений} (Application Programming Interface~--- API),
% \nomenclature{API}{Application Programming Interface}
% реализованного по технологии COM, что позволяет создавать расширения для него 
% на любых языках программирования, поддерживающих данную технологий, в\,т.\,ч.
% и рассматриваемом в рамках данной работы языке Python.
% 
% \subsection{OpenERP~6.0.3}
% \label{sec:openerp}
% 
% \begin{figure}[t!]
%     \centering
%     \includegraphics[width=\textwidth]{openerp.png}
%     \caption[Интерфейс системы OpenERP]
%             {Интерфейс системы OpenERP}
%     \label{fig:openerp}
% \end{figure}
% 
% Система OpenERP представляет собой модульную программную систему с открытым исходным кодом
% для управления ресурсами предприятия, написанную на языке Python. OpenERP
% является клиент-серверным приложением, взаимодействие в котором основано на протоколе
% XML-RPC, что позволяет обращаться к его функциям из любых приложений, поддерживающих
% работу по этому протоколу, а также даёт возможность бесшовной интеграции с ИУП ТПП.
% Серверная часть, в качестве СУБД использует PostgreSQL, клиентская часть выполнена
% как виде отдельного приложения (\autoref{fig:openerp}), так и в виде web-сервиса,
% реализованного с использованием \emph{Асинхронного JavaScript и XML} (Asynchronous Javascript and XML~--- AJAX).
% Основными модулями системы являются:
% 
% \begin{itemize}
% \item Бухгалтерия.
% \item Учёт активов.
% \item Бюджет.
% \item Система управления взаимоотношениями с клиентами.
% \item Управление персоналом.
% \item Готовая продукция.
% \item Производство.
% \item Продажи.
% \item Закупки.
% \item Запасы.
% \end{itemize}
% 
% \subsection{PyCAM~0.5.1}
% 
% PyCAM представляет собой систему генерации управляющих программ для трехкоординатных
% станков с числовым программным управлением, выпускаемую под свободной лицензией.
% В качестве входных данных система получает трёхмерную модель в формате STL или
% двумерный контур в форматах DXF или SVG и генерирует программу в формате \emph{ISO-7bit} 
% (последовательность \emph{G-кодов}). Помимо непосредственно постпроцессинга PyCAM позволяет
% визуализировать путь инструмента (\autoref{fig:pycam}).
% 
% \begin{figure}[t!]
%     \centering
%     \includegraphics[width=\textwidth]{pycam.png}
%     \caption[Интерфейс CAM-системы PyCAM]
%             {Интерфейс CAM-системы PyCAM}
%     \label{fig:pycam}
% \end{figure}
% 
% Программа написана на языке Python, что позволяет беспрепятственно интегрировать её в ИУП ТПП.
% 
% \subsection{Вертикаль 2011}
% 
% Система автоматизированного проектирования технологических процессов <<Вертикаль 2011>>
% является интеллектуальным редактором технологических документов (\autoref{fig:vertical}), связанным
% с развитой базой данных типовых процессов, а также подробными технологическими
% и конструкторскими классификаторами. Система является проприетарным\footnote{От
% англ. \emph{proprietary}~--- собственнический, частный, патентованный.} ПО, разработанным
% отечественной компанией Аскон.
% 
% \begin{figure}[t!]
%     \centering
%     \includegraphics[width=.7\textwidth]{vertical.png}
%     \caption[Интерфейс CAPP-системы Вертикаль 2011]
%             {Интерфейс CAPP-системы Вертикаль 2011}
%     \label{fig:vertical}
% \end{figure}
% 
% САПР ТП Вертикаль 2011 даёт возможность:
% 
% \begin{itemize}
% \item разрабатывать технологические процессы в нескольких автоматизированных режимах;
% \item рассчитывать материальные и трудовые затраты на производство;
% \item формировать все необходимые комплекты технологической документации,
%     используемые на предприятии;
% \item вести параллельное проектирование сложных и сквозных ТП группой технологов
%     в реальном времени;
% \item формировать заказы на проектирование специальных средств технологического
%     оснащения и создание управляющих программ;
% \item поддерживать актуальность технологической информации с помощью процессов
%     управления изменениями.
% \end{itemize}
% 
% 
% Благодаря программируемому интерфейсу приложения, созданному по технологии COM
% (которая, как уже было отмечено выше, поддерживает работу с самыми разными
% языками, в\,т.\,ч. имеет реализацию для языка Python) система Вертикаль может
% быть легко интегрирована в описываемую многоагентную технологическую систему и
% стать одним из основных элементов разрабатываемой ИУП ТПП.
% 
% \subsection{PostgreSQL~9.1.1}
% \label{sec:postgresql}
% 
% PostgreSQL~9.1.1 представляет собой универсальную свободную объектно-реляционную
% систему управления базами данных, поддерживающую большинство функций, необходимых
% для создании на её основе информационной системы практически любой сложности.
% 
% Использование PostgreSQL в качестве единой базы, хранящей информацию о ПКМ 
% обусловлено следующими факторами:
% 
% \begin{itemize}
% \item Лёгкая интеграция СУБД PostgreSQL в структуру ИУП ТПП за счёт внутренней
%     поддержки большинства современных языков программирования, включая Python.
% \item Поддержка триггеров и хранимых процедур, упрощающих работу с данными.
% \item Поддержка различных типов индексов (в\,т.\,ч. B-деревьев (см.~\autoref{sec:vsptd-table}),
%     что позволяет хранить в базе таблицы ВСПТД без дополнительной переконвертации).
% \item Поддержка большого набора встроенных типов (включая символьные типы произвольной
%     длины, геометрические примитивы и XML-данные), а также возможность создания
%     пользовательских типов.
% \item Репликации и возможность контроля целостности данных, что немаловажно
%     при работе в сложной слабоструктурированной информационной среде предприятия.
% \end{itemize}


\section{Описание агентов, моделей поведения и целей}
\label{sec:agent-classes}

% \begin{sidewaysfigure}[p!]
%     \centering
%     \includegraphics[width=\textwidth]{mas-role.eps}
%     \caption{Название рисунка}
%     \label{fig:mas-role}
% \end{sidewaysfigure}

% Архитектура агентов гибридная с преобладанием BDI-подхода, из чего следует что
% каждый класс агентов обладает своим собственным поведением, описанным ниже.
% В качестве базового инструмента разработки МАС была выбрана
% библиотека SPADE~(\autoref{sec:spade}), написанная на языке Python.
Каждый агент созданной МАС представляет собой независимый исполняемый модуль (скрипт),
базовые методы которого наследуются\footnote{
Следует отметить, что в языке Python нет понятия класса в привычном его понимании.
Классы, по сути, тоже являются объектами, а <<настоящие>> классы скрыты от
программиста. Поэтому методы, действительно, могут быть унаследованы
от объекта-прототипа~\cite{Lutz-2002, Lutz-2009, Summerfield-2009}.} от агента-прототипа~(\autoref{sec:mas-found}).
Каждый класс агентов обладает своим собственным поведением (конфигурацией, позволяющей
ему работать с определённым классом автоматизированных систем технологической
подготовки производства или специалистом, иначе говоря~--- \emph{контекстом},
см.~\autoref{sec:protoagents}), обусловленным
некоторым планом и определёнными целями. Пример
реализации простейшего агента приведён в~\autoref{app:b}.

Для сохранения максимальной простоты и гибкости в проектируемой системе автором
определены всего два базовых класса агентов:

\begin{enumerate}
\item Класс А~--- \emph{Агенты-преобразователи}.
\item Класс Б~--- \emph{Агенты-интерфейсы}.
\end{enumerate}

Агенты первого класса связаны с одной из информационных систем, использующихся
в процессе технологической подготовки производства, агенты второго
класса должны взаимодействовать с пользователями. Также определены
два сервисных агента: \emph{агент системы управления} и \emph{агент службы каталога} (\autoref{fig:agent-comm}).
\begin{sidewaysfigure}[p!]
    \centering
    \includegraphics[width=\textwidth]{agent-comm.eps}
    \caption{Схема взаимодействия агентов ИУП ТПП}
    \label{fig:agent-comm}
\end{sidewaysfigure}
К основным функциям агента системы управления
относятся: хранение транспортных адресов агентов и маршрутизация внутри агентной
среды. Основная функция агента службы каталога~--- хранение актуального списка
общесистемных и пользовательских сервисов (абстрактных ресурсов),
предоставляемых агентами. Общесистемные сервисы позволяют агентам взаимодействовать, получая
друг у друга данные и знания.
Пользовательские сервисы предоставляют оператору некоторый формализованный
диалог, в процессе работы с которым могут быть получены новые технологические данные или знания. Примерами
таких сервисов могут служить \emph{расчёт режимов резания}, \emph{подбор материала по параметрам},
\emph{расчёт усадок} и~т.\,д. Каждый сервис описывается транспортным адресом агента
и триплексной строкой параметров, которые может обработать данный сервис.


\subsection{Агент-преобразователь}
\label{sec:agent-converter}

Агент-преобразователь отвечает за создание, управление и поддержание в надлежащем
состоянии онтологии, относящейся к какой-либо конкретной подобласти информационного
поля технологической \mbox{подготовки} \mbox{производства}. Агент-преобразователь связан с
одной или несколькими информационными сущностями (в рассматриваемой упрощённой
схеме~--- с~сис\-темами технологической подготовки производства изделий из ПКМ).
Агент-преобразователь имеет интерфейс для работы с инженером по знаниям, отвечающим
за наполнение внутренней онтологии агента и подключение к~агенту различных
информационных модулей, реализующих сервисы агента. Сконфигурированный для работы с
конкретной системой автоматизации, агент-преобразователь ожидает запросы
от других агентов.

Вследствие высокой сложности рассматриваемой предметной области,
в онтологии её описания не обойтись
без наследования одних понятий другими, иными словами, многие информационные
сущности технологической подготовки производства должны образовывать строгие
иерархии. Как уже отмечалось в~\autoref{sec:hms}, для
образования подобных структур внутри гетерархической сети, агенты-преобразователи
могут образовывать постоянные или временные холархии внутри домена кооперации,
при этом агент (в~данном случае холон), отвечающий за базовые определения конкретного
класса понятий, становится координатором.

Например, в процессе подбора параметров
полимерных композиции происходит активный обмен информацией между несколькими CAE-системами,
при этом на каждом шаге этого многоитерационного процесса соответствие параметров изделия
заданным характеристикам проверяется в системе конечноэлементного анализа Samcef.
Агент данной системы становится временным координатором, управляющим
данным процессом и принимающем решение об изменении состава полимерного композиционного материала (т.\,е.~о~возврате на один шаг назад) или переходе
на следующий этап. Соответственно, когда оптимальный состав найден, данный
временный кооперационный кластер агентов распадается.


\subsection{Агент-интерфейс}

Агент-интерфейс
с одной стороны взаимодействует со специалистом, а~с~другой~---
с агентами-преобразователями. Таким образом,
агент-интерфейс помогает пользователю напрямую работать с незнакомыми ему системами,
например, технолог может напрямую обращаться к ERP-системе, получая при этом
упрощённый интерфейс, в котором будет отражена только та информация, которая 
соответствует онтологии понятий технологического процесса, а всё остальные
будут либо переведены в понятную для технолога форму, либо сконвертированы в 
соответствии с правилами перевода онтологии, либо опущены за ненадобностью.
С технической точки зрения, агент-интерфейс взаимодействует с пользователем через
web-интерфейс, т.\,е. является \emph{<<насыщенным>> интернет-приложением} (Rich Internet Application~--- RIA\footnote{%
Приложение (компьютерная программа), доступное через сеть интернет и обладающее
функциональностью традиционных настольных приложений~\cite{Farrell-2007, Fraternali-2010}.}), с~которым
пользователь работает через интернет-браузер (просмотрщик).
{\parfillskip=0pt

}

Работа с агентом-интерфейсом может осуществляться в трёх режимах:
\begin{enumerate}
 \item В режиме \emph{свободного поиска}, когда агент-преобразователь
 проводит полнотекстовый поиск в онтологическом словаре, например
 по запросу <<{\ttfamily материал липол плотность}>> система вернёт значение
 найденного параметра, а также предложит пользователю просмотреть
 дополнительные результаты, найденные в онтологии: другие параметры
 материала, входимость этого материала в состав различных ПКМ,
 изделия, соз\-данные из этого материала, оборудование и т.\,д.
 При этом поиск будет осуществляться
 во всём информационном пространстве, что достигается наличием единого
 метахранилища всех технологических данных и~знаний, т.\,е. онтологического
 словаря.
 \item В режиме \emph{поиска сервиса}, в котором по требованию
 пользователя сис\-тема вернёт либо список всех доступных агентам ИУП ТПП
 сервисов, разбитых по категориям, либо предложит воспользоваться свободным
 поиском сервиса, аналогично предыдущему варианту.
 \item В режиме \emph{работы с сервисом}, в котором агент-интерфейс
 динами\-чески формирует кумулятивный пользовательский диалог (автоматически сгенерированную web-форму) на основании
 фрейма-терминала ВСПТД. Отличительной особенностью данного диалога
 является то, что он даёт возможность пользователю работать с данными и знаниями
 сразу от~нескольких систем. Пример интерфейса, сформированного агентом
 при работе с~сервисом PDM-системы, представлен на~\autoref{fig:pdm-interface}.
\end{enumerate}

\begin{figure}[h!]
    \centering
    \includegraphics[width=.8\textwidth]{screenshot.png}
    \caption{Пример интерфейса при работе с сервисом PDM-системы}
    \label{fig:pdm-interface}
\end{figure}


% Агент-планировщик является независимым арбитром, оценивающим загруженность каждого
% агента МАС и управляющим очередью заданий каждого из них. Как уже неоднократно
% отмечалось выше любые взаимодействия между агентами внутри МАС, основываются на
% переговорах, в результате переговоров агенты должны прийти к некоторому решению,
% удовлетворяющему всех. В некоторых случаях подобная система общения может дать
% сбой, вследствие чего произойдет взаимная блокировка. Блокировка возникает при 
% превышении некоторого временного интервала (таймаута), отводимого агентам на
% переговоры. За временем следит агент, инициировавший переговоры, определив, что

\section{Опиcание взаимодействия агентов ИУП ТПП}
\label{sec:agent-impl}


Взаимодействие агентов ИУП ТПП на уровне представления осуществляется
путём обмена сообщениями на языке FIPA-ACL. Содержимое каждого сообщения
представляет собой триплексную строку, содержащую передаваемые данные или
знания. Онтология передаваемого сообщения описывается с~помощью словаря
метаданных ВСПТД (\autoref{sec:vsptd-ontology}).

Рассмотрим типовой сценарий взаимодействия агентов. После установки вычислительного
модуля интеллектуального агента на целевую платформу (систему, обеспечивающую
функционирование того или иного средства автоматизации ТПП) происходит
его инициализация. В процессе инициализации агент должен <<осознать>> себя в
среде информационно-управляющей платформы технологической подготовки производства.
Первым делом, ИУ проверяет наличие у него доступа к сети (в
данном случае имеется в виду вычислительная сеть предприятия, поверх которой
строится многоагентная сеть). Для~этого агенту необходимо послать тестовый
запрос (функция \verb!ping()!, здесь и далее см.~\autoref{fig:agent-init})
к службе управления агентами (\autoref{sec:agent-classes}). Тестовое
сообщение представляется специализированным триплетом виртуального строкового
пространства вида:

\begin{lstlisting}[
    language=python,showstringspaces=false,basicstyle=\ttfamily,
    numbers=left,numberstyle=\footnotesize,numbersep=5pt,frame=tb,
    caption=Пример тестового запроса к СУА
]
$__SERVICE.TEST=:0;
\end{lstlisting}

В данном случае, СУА был передан триплет цели, помеченный специализированным
системным префиксом \verb!__SERVICE!.\footnote{Системные префиксы ВСПТД
начинаются с символа <<двойное подчёркивание>>, они также
хранятся в онтологическом словаре метаданных, но по умолчанию скрыты.} Параметру
{\verb!TEST!} присваивается значение \verb!0!. Затем триплет помещается в
контейнер и передаётся СУА по протоколу XMPP (\autoref{sec:spade}).

\begin{figure}[p!]
    \centering
    \includegraphics[width=\textwidth]{agent-init.eps}
    \caption{UML-диаграмма последовательности действий при инициализации агента}
    \label{fig:agent-init}
\end{figure}

Если сеть доступна, и
в конфигурации агента был задан правильный транспортный адрес
СУА, данный триплет цели будет обработан, и агенту вернётся ответ, содержащий
уже триплет факта вида \verb!$__SERVICE.TEST=1;!. Если СУА в данный момент
не может обработать запрос от агента, значение триплета изменено не будет. В
этом случае агент должен повторить свой запрос через некоторое время.
Если после трех попыток ответ не получен, агент сообщает об ошибке и прекращает
свою работу.

На следующем этапе агент должен отправить СУА запрос на получение транспортного адреса (функция \verb!get_addr()!):
\begin{lstlisting}[
    language=python,showstringspaces=false,basicstyle=\ttfamily,
    numbers=left,numberstyle=\footnotesize,numbersep=5pt,frame=tb,
    caption=Пример запроса на получение транспортного адреса
]
$__SERVICE.TRANSPORT_ADDRESS=:
"00000000000000000000000000000000";
\end{lstlisting}

Значением триплета цели является пустой MD5-хэш,\footnote{Под хэшированием
понимается преобразование входного массива данных произвольной длины в~выходную
битовую строку фиксированной длины, что позволяет создавать уникальный
идентификатор агента без использования алгоритмов генерации псевдослучайных чисел.}
который обрабатывается СУА и преобразуется в триплет факта:
\begin{lstlisting}[
    language=python,showstringspaces=false,basicstyle=\ttfamily,
    numbers=left,numberstyle=\footnotesize,numbersep=5pt,frame=tb,
    caption=Транспортный адрес агента
]
$__SERVICE.TRANSPORT_ADDRESS=
"1bc29b36f623ba82aaf6724fd3b16718@tps.ifmo.ru"; 
\end{lstlisting}

Символы до знака <<\verb!@!>> являются непосредственно адресом агента,
а~символы после~--- доменным именем сервера, на котором работает СУА.
Получив транспортный адрес, агент посылает третье (после тестового и
запроса адреса) обязательное сервисное сообщение: запрос онтологического
словаря. Данное сообщение также содержит сервисный триплет
цели, но, в отличие от предыдущих, данное сообщение рассылается всем
агентам МАС, адреса которых известны СУА (функция \verb!get_ontology()!). Далее агент переходит в фазу
ожидания, ему необходимо дождаться пока все агенты пришлют ему свою
копию онтологического словаря. Это необходимо для того,
чтобы агент на момент инициализации имел наиболее полную версию словаря.

В процессе работы МАС, онтология может 
меняться, для поддержания её в~актуальном состоянии агенты время
от времени синхронизируются, и~в~этот момент целостность
онтологии нарушается. Именно поэтому инициализируемый агент дожидается, пока \emph{каждый}
из агентов МАС пришлёт ему свою копию. Также стоит отметить, что
на момент получения запроса онтологии все агенты приостанавливают
синхронизацию.

Получение копии онтологического словаря~--- последний этап инициализации
агента, после которого он переходит в режим взаимодействия с~экспертом (функция \verb!set_interface()!).
На этом этапе эксперту необходимо определить какие модули (подмодули)\footnote{%
Как уже отмечалось выше, построить многоагентную систему технологической
подготовки производства, не создавая при этом специализированных модулей-адаптеров,
невозможно. Задачей автора было максимально упростить этот процесс, сделав
его доступным для рядовых сотрудников предприятия, и~тем самым, отказаться
от необходимости привлекать профессиональных программистов, см.~\autoref{sec:protoagents}.} автоматизированной
системы технологической подготовки производства должны быть подключены к
внутреннему интерфейсу агента, определить, 
необходимо ли внести исправления (дополнения) в онтологический словарь,
а также определить какие сервисы будет предоставлять агент.
Последнее очень важно, ведь именно на~\mbox{переговорах} и~соглашениях
о~предоставлении тех или иных ресурсов (в~данном случае программных сервисов)
и~строится взаимодействие агентов внутри МАС, и~именно от них зависит
полезность каждого агента (\autoref{sec:abstract-resources}). Конкретные
примеры агентных сервисов зависят от предметной области и степени
автоматизации решаемых задач. Например, для рассматриваемой проблемы проектирования
технологии производства изделий из полимерных композиционных материалов, могут быть
определены следующие сервисы: <<сделать комплексную выборку из нескольких БД на
основании фрейма-запроса>>, <<проанализировать полученную в результате проектирования
композицию>>, <<дать количественную оценку соответствия материала заданным требованиям>>,
<<сформировать отчёт по текущей загрузке оборудования>> и~т.\,д. Полный перечень
сервисов может быть довольно обширным, поэтому детальное их рассмотрение выходит
за рамки проводимого \mbox{исследования}.

Сформированный перечень сервисов передаётся службе каталога (СК) агентной системы, где
происходит их регистрация и привязка к тому агенту, который о них заявил (функция \verb!reg_services()!).
Агент, которому необходимо получить некоторый сервис должен обратиться к СК и
посмотреть зарегистрирован ли хотя бы один сервис, который может удовлетворить его
запрос (возможно, только частично\footnote{Процесс выбора сервиса сводится к сопоставлению
триплетов цели, которые агент желает перевести в триплеты фактов, с триплексной
строкой, описывающей предоставляемый сервис. Соответственно, чем больше фактов
будет получено, тем выше будет функция полезности агента, предоставляющего
\mbox{сервис}.}). Найдя подходящий сервис,
агент получает его транспортный адрес, после чего начинается этап переговоров.
{\parfillskip=0pt

}

В процессе переговоров агенты обмениваются речевыми актами, представленными с помощью
языка FIPA-ACL, инкапсулированными в сообщения XMPP (в соответствии с требованиями
агентной библиотеки SPADE). В~качестве языка описания содержимого используется триплексная строка
виртуального строкового пространства технологических данных.

Рассмотрим пример, в котором агент-преобразователь ERP-системы обращается к агенту-преобразователю
PDM-системы, желая получить определённые параметры композиционного материала для нормирования.
С целью упрощения данного примера будет описана процедура получения всего одного параметра \emph{Плотность}. Следует отметить, что, 
несмотря на кажущуюся простоту данной операции, её реализация напрямую и штатными методами
невозможна. Использованная в процессе технологической подготовки производства изделий из ПКМ
PDM-система (SmarTeam, см.~прил.~\ref{app:smarteam}) использует объектную базу
данных, обращение к которой возможно только через внутренний СОМ API системы, в то время
как ERP-система (OpenERP, см.~прил.~\ref{app:openerp}) хранит свои записи в реляционной базе
PostgreSQL (прил.~\ref{app:postgresql}), причём из соображений безопасности не позволяет
обращаться к БД напрямую, а использует высокоуровневый API на языке Python. Следовательно, такая,
казалось~бы, простая операция как получение одного параметра \emph{Плотность} требует
создания модуля, который, как минимум, обращался бы к~API системы OpenERP, вызывал функцию
выборки и передавал ей заранее подготовленный SQL-запрос, затем получал результат этого
запроса, преобразовывал его в соответствии со своей внутренней логикой, вызывал API
системы SmarTeam, формировал бы запросы к объектной БД, выполнял его, получал результат
и~делал его обратное преобразование для размещения в БД OpenERP.
Работа с подобным <<чёрным ящиком>> может вызвать ряд проблем:
{\looseness=-1

}

\begin{enumerate}
 \item Понятие \emph{Плотность}
в разных системах может обозначаться по-разному (например, в ERP-системе может быть поле, называемое
\verb!DENSITY!, а~PDM~--- объект, именуемый <<\emph{Плотность материала}>>).

\item\textls[-10]{Описываемый модуль может связать только две системы, установленные на одной машине,
в противном случае, ему придётся использовать сетевые вызовы COM, что необоснованно
усложнит его внутреннюю реализацию.}
 \item Любые, даже незначительные, изменения в структуре данных или API описываемых систем повлекут за
 собой необходимость изменения кода модуля и его перекомпиляции.
\end{enumerate}

Предлагаемый автором подход позволяет существенно упростить подобную интеллектуальную интеграцию.
Во-первых, агенты МАС не оперируют с~понятиями, обозначающими данные напрямую, все
они хранятся в онтологическом словаре в виде концептов, относящимися к определённому классу и~обладающих
некоторыми атрибутами, связями~и~т.\,д. Так,
в~рассматриваемом примере, агент ERP-системы обратится к онтологии понятий, относящихся
к~полимерным композиционным материалам для получения концепта по его синониму:\footnote{%
Предполагается, что концепт обладает этим атрибутом и его значение заполнено экспертом
(инженером по знаниям) на этапе инициализации агента.}
{\looseness=-1

}
{\singlespacing
\begin{lstlisting}[
    language=python,showstringspaces=false,basicstyle=\ttfamily,
    numbers=left,numberstyle=\footnotesize,numbersep=5pt,frame=tb,
    caption=Получение концепта по его синониму
]
erp.set_ontology('ПКМ')
erp.attrs += mas.get_by_syn('DENSITY')
\end{lstlisting}}

\noindent\textls[-15]{В результате агент получает триплексную строку с выборкой по синониму:}
{\parfillskip=0pt

}

{\singlespacing
\begin{lstlisting}[
    language=python,showstringspaces=false,basicstyle=\ttfamily,
    numbers=left,numberstyle=\footnotesize,numbersep=5pt,frame=tb,
    caption=Представление онтологического синонима
]
$PCM.PLOTN="_S_'$0A=Плотность';$1A='DENSITY';
                $2A='Плотность материала';"
\end{lstlisting}}

В данной записи \verb!0A!~--- ссылка на агент-прототип, хранящий базовое определение
онтологического концепта~(\autoref{sec:agent-converter}), в списке синонимов значение
от агента 0A является главным для внутренней работы ВСПТД; \verb!1A!~--- идентификатор объекта
агента ERP; \verb!2A!~--- идентификатор объекта агента PDM; \verb!_S_!~---
системная строка, указывающая на тип <<значения-синонимы>>.\footnote{%
В тех случаях, когда коллизии с синонимами отсутствуют, и значения величин характеристик одинаковы для всех агентов,
работа с триплетами ВСПТД идёт в обычном режиме.}

\textls[-15]{Получив обозначение концепта, ERP-агент формирует триплет цели и~помещает
его в виртуальное строковое пространство технологических данных: {\ttfamily\$PCM.PLOTN=:;}. Таким же образом могут быть обработаны
все <<статические данные>>, необходимые агенту для взаимодействия, после
чего начинается фаза работы со знаниями. Агенту необходимо преобразовать
семантическое понятие <<запрос параметра>>, представленное с помощью
языка SQL в форму, используемую в рассматриваемой технологической МАС.
Для этого агент вновь обращается к онтологическому словарю, по синониму
получает концепт <<фрейм-запрос>> (данный параметр является системным,
поэтому не добавляется в виртуальное строковое пространство технологических данных агента), к которому присоединена процедура
преобразования подобных семантических конструкций}.%
\footnote{Преобразование
осуществляется за счёт использования модели, представляющей \emph{Объектно-реляционную
проекцию} (Object-relational mapping~--- ORM), данный механизм подробно
описан в работе~\cite{my_2}.}
{\looseness=-1\parfillskip=0pt

}
\nomenclature{ORM}{Object-relational mapping}

Получив таким образом фрейм-запрос, агент ERP-системы может сформировать перформатив
(речевой акт) \verb!Request! и передать его агенту PDM-системы (\autoref{lst:request}).

{\singlespacing
\begin{lstlisting}[
    language=python,showstringspaces=false,basicstyle=\ttfamily,
    numbers=left,numberstyle=\footnotesize,numbersep=5pt,frame=tb,
    caption=Пример речевого акта {\ttfamily Request},label=lst:request
]
{"запрос": {
    "отправитель": {
        "идентификатор":
        "1bc29b36f623ba82aaf6724fd3b16718@tps.ifmo.ru"
    },
    "Получательтель": {
        "идентификатор":
        "8a8884ee553cceaa82aaf6724fd3b167@tps.ifmo.ru"
    },
    "содержимое": [
        "$PCM.PLOTN=:;$PCM.CODE=09857865;",
    ],
    "протокол": "запрос-ответ",
    "язык": "всптд",
    "онтология": "полимерные композиционные материалы",
}
\end{lstlisting}}


\textls[-20]{После получения запроса ({\ttfamily Request}) агент PDM-системы должен проанализировать его и дать
ответ принимает ли он его ({\ttfamily Agree}) или нет ({\ttfamily Refuse}). Если запрос принят,
агенту PDM-системы необходимо обработать его (т.\,е.~аналогичным образом обратиться
к онтологии, привести в соответствие свои внутренние понятия и т.\,д.) и вернуть один из
следующих перформативов} (\autoref{fig:app-auml-1}):
{\parfillskip=0pt

}

\begin{figure}[p!]
    \centering
    \includegraphics[width=.8\textwidth]{app-auml-1.eps}
    \caption{AUML-диаграмма взаимодействия двух агентов при запросе ресурса}
    \label{fig:app-auml-1}
\end{figure}

\begin{itemize}
 \item \verb!Failure!, в случае возникновения ошибок.
 \item \verb!Inform-done:inform!, в случае, если запрос просто обработан (не требуется возвращать какой-либо результат).
 \item \verb!Inform-result:inform!, в случае, если запрос успешно обработан и~получен некоторый результат, который необходимо
 вернуть запрашиваемому агенту.
\end{itemize}



В рассматриваемом примере агенту ERP-системы будет передано сообщение, содержимым которого будет
триплексная строка, описывающая запрашиваемый параметр, который будет преобразован к
внутреннему представлению системы и помещён в базу. После этого оба агента вернуться
в~фазу \mbox{ожидания}.

Рассмотренный пример описывает самый простой из вариантов взаимодействия
агентов внутри информационно-управляющей платформы технологической подготовки
производства~--- взаимодействие по схеме <<запрос-ответ>>, тем не менее даже он
позволяет осуществить интеллектуальную интеграцию средств автоматизации в едином информационном
пространстве технологической подготовки изделий из полимерных композиционных материалов.
Использование же более сложных методов (описанных в~\autoref{sec:FIPA-standards})
позволит создать децентрализованную сеть управления ТПП, способную работать
не~только в~рамках одного предприятия, но и выполнять задачи по интеграции внутри
целого производственного кластера.

\section{Выводы и результаты по четвёртой главе}

Показана реализация многоагентной информационно-управляющей платформы технологической
подготовки производства изделий из полимерных композиционных материалов. Выбор
направления интеграции обусловлен высокой сложностью автоматизации данной
задачи вследствие необходимости задействования дополнительных автоматизированных
систем технологической подготовки производства,
используемых в процессе проектирования состава полимерной композиции и
анализа характеристик изготавливаемого из~него изделия, а также многоитерационностью
этого процесса. В процессе конфигурирования информационно-управляющей
платформы технологической подготовки производства:

\begin{enumerate}
 \item Описана модель взаимодействия информационных потоков, возникающих в процессе
 технологической подготовки производства изделий из~полимерных композиционных материалов.
 \item Описаны конкретные автоматизированные системы и их роль в процессе
 выбора и проектирования нового материала, а также разработки технологии изготовления изделия
 из этого материала.
 \item С помощью распределённого виртуального испытательного стенда создана модель
 интеграционной сети информационно-управляющей платформы технологической подготовки
 производства изделий из полимерных композиционных материалов,
 учитывающая специфику средств аппаратного обеспечения и позволяющая взаимодействовать
 с~АСТПП посредством использования удалённых рабочих мест.
 \item Разработаны и программно реализованы базовые классы многоагентной системы, описаны их функции и основные
 характеристики. Особое внимание уделено пользовательскому интерфейсу
 каждого агента, позволяющему строить динамические диалоговые формы, основанные
 на фреймах-терминалах виртуального строкового пространства технологических данных.
 \item Описан жизненный цикл технологического агента информационно-управляющей
 платформы, а также программно реализованы архитектура агента и процесс
 взаимодействия агентов для осуществления интеллектуальной интеграции при решении
 конкретных задач технологической подготовки производства изделий из полимерных композиционных материалов.
\end{enumerate}

Моделирование многоагентной информационно-технологической платформы технологической
подготовки производства средствами распределённого виртуального испытательного стенда % показало достоверность реализованной
позволило оценить достоверность разработанного метода многоагентной интеграции,
а также сделать вывод о~том, что рассматриваемая технология может быть перенесена
в реальные производственные условия.


% Таким образом
% \pagebreak
% В данном случае инициатором переговоров является агент САМ-системы, отправляющий
% агенту PDM-системы запрос (речевой акт \verb!Request!) вида:
% 




%Не забыть написать о том, что РВИС должно в пределе заменить всю инфраструктуру предприятия
% Пересечение трех основных и двух вспомогательных информационных полей (CAD и CAE оснастки)
%Агент-интерфейс, позволяющий неспециалисту рабнтотать с той или иной системой
%через упрощенный веб-интерфейсх

% Агент-преобразователь
% Агент-планировщик
% Агент-отчётчик
% Агент-диспетчер данных следит за изменением данных в соответствии с онтологией
% терминов, с которой он взаимодействует